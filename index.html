<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gaia Dominium - MVP</title>
    <style>
        :root {
            --color-primary: #32b8c6;
            --color-primary-dark: #1d7480;
            --color-bg: #1a1a1a;
            --color-surface: #252525;
            --color-text: #e0e0e0;
            --color-text-secondary: #a0a0a0;
            --color-accent: #4caf50;
            --color-accent-dark: #2e7d31;
            --color-error: #f44336;
            --sidebar-width: 200px; /* Largura reduzida */
            --header-height: 50px;
            --action-panel-height: 90px; /* Altura ajustada */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            height: 100%;
            overflow: hidden;
        }

        /* O Container principal agora lida com o layout de duas colunas */
        .container {
            display: flex;
            height: 100vh;
            position: relative;
        }

        /* Header (Permanece fixo no topo) */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background-color: var(--color-surface);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
            z-index: 10;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--color-primary);
        }

        .manual-icon {
            cursor: pointer;
            color: var(--color-text);
            font-size: 1.5rem;
            transition: color 0.2s;
        }

        .manual-icon:hover {
            color: var(--color-primary);
        }

        /* Painel Lateral (Status) - Largura fixa reduzida */
        .sidebar {
            width: var(--sidebar-width);
            min-width: var(--sidebar-width); /* Garante que n√£o encolhe */
            height: calc(100vh - var(--header-height));
            margin-top: var(--header-height);
            background-color: var(--color-surface);
            padding: 20px 10px; /* Padding reduzido horizontalmente */
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 5;
            overflow-y: auto;
        }

        .sidebar h2 {
            font-size: 1.1rem; /* Fonte ligeiramente menor */
            color: var(--color-primary);
            border-bottom: 2px solid var(--color-primary-dark);
            padding-bottom: 5px;
            margin-bottom: 5px; /* Espa√ßo reduzido */
        }

        .resource-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            background-color: var(--color-bg);
            border-radius: 6px;
            font-size: 0.9rem; /* Fonte ligeiramente menor */
            align-items: center;
        }

        .resource-item .label {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--color-text-secondary);
        }

        .resource-item .value {
            font-weight: bold;
            color: var(--color-text);
        }

        /* √Årea Principal do Jogo (Mapa e A√ß√µes) */
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column; /* Mapa e A√ß√µes em Coluna */
            margin-top: var(--header-height);
        }

        /* Visor de Feedback */
        #feedbackMessage {
            position: absolute;
            top: 50%;
            left: calc(var(--sidebar-width) + 50%); /* Ajusta a posi√ß√£o central com base na sidebar */
            transform: translate(-50%, -50%);
            padding: 15px 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--color-text);
            text-align: center;
            z-index: 50;
            pointer-events: none;
            transition: opacity 0.3s, transform 0.3s;
            opacity: 0;
            min-width: 400px;
        }

        #feedbackMessage.info { background-color: rgba(50, 184, 198, 0.9); }
        #feedbackMessage.success { background-color: rgba(76, 175, 80, 0.9); }
        #feedbackMessage.error { background-color: rgba(244, 67, 54, 0.9); }
        #feedbackMessage.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }
        
        /* Mapa - Ocupa todo o espa√ßo vertical dispon√≠vel menos a barra de a√ß√µes */
        .game-map {
            flex-grow: 1;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 3px; /* Gap um pouco maior */
            padding: 10px;
            background-color: var(--color-bg);
            position: relative;
            overflow: auto; /* Para garantir que o grid n√£o estoure em telas pequenas */
        }

        .region {
            background-color: var(--color-surface);
            border: 2px solid var(--color-bg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 0.8rem;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s, border-color 0.2s;
            border-radius: 6px;
        }

        .region:hover { background-color: #353535; }
        .region.selected {
            border-color: var(--color-primary);
            box-shadow: 0 0 10px var(--color-primary);
            transform: scale(1.02);
        }
        .region-name { font-weight: bold; margin-bottom: 3px; color: var(--color-primary); }
        .region-info { font-size: 0.7rem; color: var(--color-text-secondary); }

        /* Painel de A√ß√µes (Barra inferior) - Altura Fixa */
        .action-panel {
            height: var(--action-panel-height);
            background-color: var(--color-surface);
            padding: 10px 20px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.5);
            z-index: 5;
            flex-shrink: 0; /* Garante que n√£o encolhe */
        }

        .action-btn {
            background-color: var(--color-primary);
            color: var(--color-bg);
            border: none;
            padding: 12px 25px; /* Bot√µes maiores */
            font-size: 1rem;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s, opacity 0.2s;
            box-shadow: 0 4px var(--color-primary-dark);
            position: relative;
            top: 0;
            min-width: 170px; /* Largura m√≠nima ajustada */
        }

        .action-btn:hover:not(:disabled) { background-color: var(--color-primary-dark); transform: translateY(-2px); box-shadow: 0 6px var(--color-primary-dark); }
        .action-btn:active:not(:disabled) { transform: translateY(2px); box-shadow: 0 2px var(--color-primary-dark); }
        .action-btn:disabled { background-color: #555; color: #aaa; cursor: not-allowed; box-shadow: 0 4px #444; }

        #endTurnBtn { background-color: var(--color-accent); box-shadow: 0 4px var(--color-accent-dark); }
        #endTurnBtn:hover:not(:disabled) { background-color: var(--color-accent-dark); box-shadow: 0 6px var(--color-accent-dark); }
        #endTurnBtn:active:not(:disabled) { box-shadow: 0 2px var(--color-accent-dark); }

        #startGameBtn { background-color: var(--color-accent); box-shadow: 0 4px var(--color-accent-dark); }

        /* Tela Inicial de Bloqueio - Cobre apenas a √°rea do jogo, excluindo a sidebar */
        .initial-screen {
            position: absolute;
            top: var(--header-height);
            left: var(--sidebar-width);
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.95); /* Cor mais escura para contraste */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            gap: 20px;
            text-align: center;
        }

        .initial-screen.hidden { display: none; }
        .initial-screen h1 { color: var(--color-primary); font-size: 3rem; }
        .initial-screen p { color: var(--color-text); font-size: 1.2rem; max-width: 600px; }


        /* Modal Manual (Sem altera√ß√£o) */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .modal-overlay.active { display: flex; }
        .modal-content {
            background: var(--color-surface);
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
        }

        .modal-header { padding: 15px 20px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; background-color: #333; }
        .modal-header h3 { margin: 0; color: var(--color-primary); }
        .modal-close { background: none; border: none; color: var(--color-text); font-size: 1.5rem; cursor: pointer; }
        .modal-body { display: flex; flex-grow: 1; overflow: hidden; }
        .modal-sidebar { width: 150px; background-color: #333; padding: 10px 0; flex-shrink: 0; }
        .modal-tab { display: block; padding: 10px 15px; color: var(--color-text-secondary); cursor: pointer; transition: background-color 0.2s, color 0.2s; }
        .modal-tab:hover { background-color: #444; color: var(--color-text); }
        .modal-tab.active { background-color: var(--color-surface); color: var(--color-primary); font-weight: bold; }
        .modal-main { flex-grow: 1; padding: 20px; overflow-y: auto; }
        .modal-section { display: none; }
        .modal-section.active { display: block; }
        
        .svg-icon { width: 24px; height: 24px; fill: currentColor; }

        /* Responsive adjustments for mobile/tablet */
        @media (max-width: 768px) {
            :root {
                --sidebar-width: 100%;
                --header-height: 50px;
                --action-panel-height: 120px; /* Maior para bot√µes empilhados */
            }

            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: 80px; /* Altura fixa para mobile */
                margin-top: var(--header-height);
                flex-direction: row;
                flex-wrap: nowrap;
                justify-content: space-around;
                align-items: center;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
                padding: 5px 10px;
                overflow-x: auto; /* Permite rolar recursos se muitos */
            }
            
            .sidebar h2 { display: none; } /* Oculta t√≠tulos na sidebar mobile */
            .resource-item { padding: 4px 8px; font-size: 0.8rem; }
            .resource-item .label { display: none; } /* Oculta texto, mostra apenas o emoji e valor */
            
            .main-content {
                margin-top: calc(var(--header-height) + 80px); /* Ajusta para header + sidebar mobile */
                height: calc(100vh - var(--header-height) - 80px);
            }

            .action-panel {
                flex-wrap: wrap;
                height: var(--action-panel-height);
                gap: 5px;
                padding: 5px;
            }
            .action-btn {
                width: 48%; /* 2 bot√µes por linha */
                min-width: 0;
                padding: 8px;
                font-size: 0.9rem;
            }
            
            #feedbackMessage {
                left: 50%; /* Centraliza novamente na tela */
            }

            .initial-screen {
                left: 0;
                top: calc(var(--header-height) + 80px); /* Ajusta a posi√ß√£o inicial */
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo">Gaia Dominium</div>
        <div class="manual-icon" id="manualIcon">
            <!-- Livro Icone SVG -->
            <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M18 2H6C4.9 2 4 2.9 4 4v16c0 1.1 0.9 2 2 2h12c1.1 0 2-0.9 2-2V4C20 2.9 19.1 2 18 2zM6 4h12v16H6V4zm7 14h-2v-2h2v2zm0-4h-2V7h2v7z"/>
            </svg>
        </div>
    </div>

    <div class="container">
        <!-- Sidebar: Recursos e Pontos de Vit√≥ria -->
        <div class="sidebar">
            <h2>Recursos (Fac√ß√£o Verde)</h2>
            <div id="recursosDisplay">
                <!-- Conte√∫do atualizado por JS -->
            </div>
            <h2>Pontos de Vit√≥ria</h2>
            <div class="resource-item">
                <span class="label">üèÜ PVs Totais:</span>
                <span class="value" id="pvDisplay">0</span>
            </div>
            <div class="resource-item">
                <span class="label">Turno Atual:</span>
                <span class="value" id="turnoDisplay">0</span>
            </div>
        </div>

        <!-- Main Content (√Årea do Mapa + Barra de A√ß√µes) -->
        <div class="main-content">
            <!-- Game Map (Ocupa o m√°ximo poss√≠vel) -->
            <div class="game-map" id="gameMap">
                <!-- Regi√µes geradas por JS -->
            </div>

            <!-- Panel de A√ß√µes (Barra inferior fixa) -->
            <div class="action-panel">
                <button class="action-btn" id="construirBtn" onclick="executarAcao('Construir')" disabled>Construir (5 M, 2 P)</button>
                <button class="action-btn" id="recolherBtn" onclick="executarAcao('Recolher')" disabled>Recolher (1 M, 1 √Å)</button>
                <button class="action-btn" id="negociarBtn" onclick="executarAcao('Negociar')" disabled>Negociar (1 G, 1 PV)</button>
                <button class="action-btn" id="endTurnBtn" onclick="finalizarTurno()" disabled>Finalizar Turno</button>
            </div>
        </div>
    </div>
    
    <!-- Tela Inicial de Bloqueio -->
    <div class="initial-screen" id="initialScreen">
        <h1>Bem-vindo a Gaia Dominium</h1>
        <p>
            Gerencie recursos, expanda seu dom√≠nio e acumule Pontos de Vit√≥ria. <br>
            Lembre-se: Voc√™ s√≥ pode realizar **UMA A√á√ÉO** (Construir, Recolher ou Negociar) por turno.
        </p>
        <button class="action-btn" id="startGameBtn" onclick="iniciarJogo()">Iniciar Jogo</button>
    </div>

    <!-- Visor de Feedback Central -->
    <div id="feedbackMessage" class="feedback-message"></div>

    <!-- Modal Manual (N√£o alterado) -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Manual do Jogo</h3>
                <button class="modal-close" onclick="fecharManual()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-sidebar">
                    <span class="modal-tab active" onclick="mudarAba('visaoGeral')">Vis√£o Geral</span>
                    <span class="modal-tab" onclick="mudarAba('mecanicas')">Mec√¢nicas</span>
                    <span class="modal-tab" onclick="mudarAba('acoes')">A√ß√µes</span>
                    <span class="modal-tab" onclick="mudarAba('dicas')">Dicas</span>
                </div>
                <div class="modal-main">
                    <div class="modal-section active" id="visaoGeral">
                        <h4>Vis√£o Geral</h4>
                        <p>Gaia Dominium √© um jogo de estrat√©gia digital que combina gerenciamento de recursos e intera√ß√£o entre jogadores. O objetivo √© acumular Pontos de Vit√≥ria (PVs) para conquistar o planeta.</p>
                        <p>Cada jogador controla uma Fac√ß√£o com recursos iniciais (Madeira, Pedra, Ouro, √Ågua) e uma renda baseada em regi√µes e projetos ativos.</p>
                    </div>
                    <div class="modal-section" id="mecanicas">
                        <h4>Mec√¢nicas Principais</h4>
                        <p><strong>Ciclo de Turno:</strong> Cada turno come√ßa com a Fase de Renda (produ√ß√£o) e passa para a Fase de A√ß√£o.</p>
                        <p><strong>A√ß√£o √önica:</strong> Voc√™ s√≥ pode escolher e executar uma das tr√™s a√ß√µes principais (Construir, Recolher ou Negociar) por turno.</p>
                        <p><strong>Recursos:</strong> Madeira (M), Pedra (P), Ouro (G), √Ågua (√Å). Gerencie-os com sabedoria, pois o custo da a√ß√£o √© verificado *antes* da execu√ß√£o.</p>
                    </div>
                    <div class="modal-section" id="acoes">
                        <h4>A√ß√µes Dispon√≠veis</h4>
                        <ul>
                            <li><strong>Construir:</strong> Custo 5 Madeira, 2 Pedra. Adiciona uma estrutura, aumentando a renda e concedendo PVs.</li>
                            <li><strong>Recolher:</strong> Custo 1 Madeira, 1 √Ågua. Gasto menor, focado em produ√ß√£o e pequenos ganhos de PV.</li>
                            <li><strong>Negociar:</strong> Custo 1 Ouro. Converte recursos excedentes em recursos escassos ou PVs.</li>
                        </ul>
                    </div>
                    <div class="modal-section" id="dicas">
                        <h4>Dicas Estrat√©gicas</h4>
                        <p>Priorize a√ß√µes que fornecem PVs no in√≠cio. Use o Ouro (G) para negocia√ß√µes estrat√©gicas. Nunca se esque√ßa de clicar em "Finalizar Turno" ap√≥s sua a√ß√£o √∫nica.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script type="module">
        // Vari√°veis globais para simula√ß√£o (substituir por Firestore em um app real)
        let jogo = {
            turno: 0,
            pv: 0,
            recursos: {
                madeira: 10,
                pedra: 5,
                ouro: 3,
                agua: 5
            },
            regioes: [],
            faccao: 'Verde',
            acoesPermitidas: true
        };

        const mapSize = 5;
        const regionNames = [
            "Bacia", "Pico", "Vale", "Delta", "Costa",
            "Clareira", "Bosque", "Brejo", "Montanha", "Litoral",
            "Rio", "Plan√≠cie", "Savana", "Deserto", "O√°sis",
            "Tundra", "Taiga", "Geleira", "Vulc√£o", "Fosso",
            "Reserva", "Floresta", "Lago", "Prado", "Caverna"
        ];

        // --- Fun√ß√µes de Utilit√°rios ---
        function mostrarFeedback(message, type = 'info', duration = 3000) {
            const feedbackEl = document.getElementById('feedbackMessage');
            feedbackEl.textContent = message;
            feedbackEl.className = `feedback-message ${type} show`;
            
            clearTimeout(feedbackEl.timeoutId);
            feedbackEl.timeoutId = setTimeout(() => {
                feedbackEl.classList.remove('show');
            }, duration);
        }

        function getEmoji(resource) {
            switch (resource) {
                case 'madeira': return 'üå≤';
                case 'pedra': return 'üóø';
                case 'ouro': return 'üí∞';
                case 'agua': return 'üíß';
                default: return '‚ùì';
            }
        }

        // --- Fun√ß√µes de Jogo ---

        function inicializarMapa() {
            jogo.regioes = [];
            for (let i = 0; i < mapSize * mapSize; i++) {
                jogo.regioes.push({
                    id: i,
                    nome: regionNames[i],
                    bioma: ['Floresta', 'Savana', 'P√¢ntano', 'Tundra'][Math.floor(Math.random() * 4)],
                    controlador: jogo.faccao,
                    nivelExploracao: 0
                });
            }
            renderizarMapa();
        }

        function renderizarMapa() {
            const mapEl = document.getElementById('gameMap');
            mapEl.innerHTML = '';
            jogo.regioes.forEach(regiao => {
                const regionEl = document.createElement('div');
                regionEl.classList.add('region');
                regionEl.innerHTML = `
                    <span class="region-name">${regiao.nome}</span>
                    <span class="region-info">${regiao.bioma}</span>
                    <span class="region-info">Expl.: ${regiao.nivelExploracao}</span>
                `;
                regionEl.addEventListener('click', () => selecionarRegiao(regiao.id));
                mapEl.appendChild(regionEl);
            });
        }

        function atualizarDisplay() {
            document.getElementById('pvDisplay').textContent = jogo.pv;
            document.getElementById('turnoDisplay').textContent = jogo.turno;

            const recursosEl = document.getElementById('recursosDisplay');
            recursosEl.innerHTML = '';
            
            for (const [key, value] of Object.entries(jogo.recursos)) {
                recursosEl.innerHTML += `
                    <div class="resource-item">
                        <span class="label">${getEmoji(key)} ${key.charAt(0).toUpperCase() + key.slice(1)}:</span>
                        <span class="value">${value}</span>
                    </div>
                `;
            }
        }

        function iniciarJogo() {
            document.getElementById('initialScreen').classList.add('hidden');
            mostrarFeedback("Jogo iniciado! Clique em 'Iniciar Turno' para come√ßar a Fase de Renda.", 'info', 5000);
            
            // For√ßa a habilita√ß√£o para o primeiro turno
            document.getElementById('endTurnBtn').textContent = "Iniciar Turno (Turno 1)";
            document.getElementById('endTurnBtn').disabled = false;
        }

        function iniciarTurno() {
            jogo.turno++;
            
            // 1. Fase de Renda (Produ√ß√£o)
            // Simula√ß√£o de renda base
            jogo.recursos.madeira += 2;
            jogo.recursos.pedra += 1;
            
            // Renda por Explora√ß√£o (exemplo)
            const rendaExploracao = jogo.regioes.filter(r => r.controlador === jogo.faccao && r.nivelExploracao > 0).length;
            jogo.recursos.madeira += rendaExploracao;
            jogo.recursos.agua += rendaExploracao;

            // 2. Fase de A√ß√£o: Habilita bot√µes
            jogo.acoesPermitidas = true;
            document.getElementById('construirBtn').disabled = false;
            document.getElementById('recolherBtn').disabled = false;
            document.getElementById('negociarBtn').disabled = false;
            document.getElementById('endTurnBtn').disabled = true;
            document.getElementById('endTurnBtn').textContent = "Finalizar Turno";

            atualizarDisplay();
            mostrarFeedback(`Turno ${jogo.turno} iniciado. Renda base recebida. Escolha UMA a√ß√£o.`, 'info');
        }

        function verificarCusto(acao) {
            let custo = {};
            switch (acao) {
                case 'Construir':
                    custo = { madeira: 5, pedra: 2 };
                    break;
                case 'Recolher':
                    custo = { madeira: 1, agua: 1 };
                    break;
                case 'Negociar':
                    custo = { ouro: 1 };
                    break;
                default:
                    return { podeExecutar: false, mensagem: "A√ß√£o desconhecida." };
            }

            let podeExecutar = true;
            let recursosFaltando = [];

            for (const [recurso, quantidade] of Object.entries(custo)) {
                if (jogo.recursos[recurso] < quantidade) {
                    podeExecutar = false;
                    recursosFaltando.push(`${quantidade} de ${recurso}`);
                }
            }

            if (!podeExecutar) {
                return { 
                    podeExecutar: false, 
                    mensagem: `Recursos insuficientes. Faltam: ${recursosFaltando.join(', ')}.`,
                    custo: custo
                };
            }

            return { podeExecutar: true, custo: custo };
        }

        function executarAcao(acao) {
            if (!jogo.acoesPermitidas) {
                mostrarFeedback("Voc√™ j√° executou uma a√ß√£o neste turno. Por favor, finalize o turno.", 'error');
                return;
            }

            const resultadoCusto = verificarCusto(acao);

            if (!resultadoCusto.podeExecutar) {
                mostrarFeedback(resultadoCusto.mensagem, 'error', 4000);
                return;
            }

            // 1. Gasta recursos
            for (const [recurso, quantidade] of Object.entries(resultadoCusto.custo)) {
                jogo.recursos[recurso] -= quantidade;
            }

            // 2. Aplica Efeito
            let mensagemEfeito = '';
            switch (acao) {
                case 'Construir':
                    jogo.pv += 5;
                    jogo.regioes[0].nivelExploracao += 1; // Exemplo: afeta a primeira regi√£o
                    mensagemEfeito = "Estrutura constru√≠da. +5 PV e +1 N√≠vel de Explora√ß√£o na Bacia.";
                    break;
                case 'Recolher':
                    jogo.recursos.madeira += 4;
                    jogo.recursos.pedra += 1;
                    jogo.pv += 2;
                    mensagemEfeito = "Recursos recolhidos. +4 Madeira, +1 Pedra e +2 PV.";
                    break;
                case 'Negociar':
                    jogo.recursos.pedra += 3;
                    jogo.recursos.agua -= 1; // Negocia√ß√£o: troca Ouro por Pedra, mas gasta √Ågua
                    jogo.pv += 3;
                    mensagemEfeito = "Negocia√ß√£o conclu√≠da. Voc√™ ganhou +3 Pedra e +3 PV, mas gastou 1 √Ågua.";
                    break;
            }

            // 3. Bloqueia a√ß√µes e habilita Finalizar Turno
            jogo.acoesPermitidas = false;
            document.getElementById('construirBtn').disabled = true;
            document.getElementById('recolherBtn').disabled = true;
            document.getElementById('negociarBtn').disabled = true;
            document.getElementById('endTurnBtn').disabled = false;

            atualizarDisplay();
            mostrarFeedback(`‚úÖ ${acao} executada! ${mensagemEfeito} Agora, clique em 'Finalizar Turno'.`, 'success', 6000);
            renderizarMapa(); // Atualiza o mapa ap√≥s a a√ß√£o
        }

        function finalizarTurno() {
            // Habilita a pr√≥xima a√ß√£o: Iniciar Turno
            document.getElementById('construirBtn').disabled = true;
            document.getElementById('recolherBtn').disabled = true;
            document.getElementById('negociarBtn').disabled = true;
            document.getElementById('endTurnBtn').disabled = false;
            
            document.getElementById('endTurnBtn').textContent = `Iniciar Turno (Turno ${jogo.turno + 1})`;

            atualizarDisplay();
            mostrarFeedback(`Turno ${jogo.turno} finalizado. Prepare-se para o pr√≥ximo turno.`, 'info');
        }

        function selecionarRegiao(regiaoId) {
            // L√≥gica de sele√ß√£o (mantida simples)
            document.querySelectorAll('.region').forEach(el => el.classList.remove('selected'));
            document.querySelectorAll('.region')[regiaoId].classList.add('selected');
            mostrarFeedback(`Regi√£o ${jogo.regioes[regiaoId].nome} selecionada.`, 'info', 1500);
        }

        // --- Fun√ß√µes Manuais (sem altera√ß√£o) ---
        function abrirManual() {
            document.getElementById('modalOverlay').classList.add('active');
        }

        function fecharManual() {
            document.getElementById('modalOverlay').classList.remove('active');
        }

        function mudarAba(abaId) {
            // Remove active de todas as abas
            document.querySelectorAll('.modal-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.modal-section').forEach(section => {
                section.classList.remove('active');
            });

            // Adiciona active para a aba selecionada
            // Nota: Evento 'click' √© passado implicitamente
            event.target.classList.add('active');
            document.getElementById(abaId).classList.add('active');
        }

        // Event Listeners
        document.getElementById('manualIcon').addEventListener('click', abrirManual);
        document.getElementById('modalOverlay').addEventListener('click', function(e) {
            if (e.target === this) fecharManual();
        });

        // Inicializar Jogo
        inicializarMapa();
        atualizarDisplay();
    </script>
</body>
</html>
